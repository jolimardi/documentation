"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[672],{5541(e,n,r){r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"laravel/Installation/StepByStep/routes-controllers","title":"Routes et Base Controller","description":"Ajouter le namespace pour charger automatiquement les controllers","source":"@site/docs/laravel/Installation/StepByStep/05-routes-controllers.md","sourceDirName":"laravel/Installation/StepByStep","slug":"/laravel/Installation/StepByStep/routes-controllers","permalink":"/documentation/docs/laravel/Installation/StepByStep/routes-controllers","draft":false,"unlisted":false,"editUrl":"https://github.com/jolimardi/documentation/docs/laravel/Installation/StepByStep/05-routes-controllers.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Routes et Base Controller"},"sidebar":"laravelSidebar","previous":{"title":"Layout Principal","permalink":"/documentation/docs/laravel/Installation/StepByStep/layout-principal"},"next":{"title":"JQuery, FancyBox...","permalink":"/documentation/docs/laravel/Installation/StepByStep/jquery-plugins"}}');var s=r(4848),o=r(8453);const a={title:"Routes et Base Controller"},l=void 0,i={},u=[{value:"Ajouter le namespace pour charger automatiquement les controllers",id:"ajouter-le-namespace-pour-charger-automatiquement-les-controllers",level:2},{value:"Configurer BaseController et IndexController",id:"configurer-basecontroller-et-indexcontroller",level:2},{value:"Configurer les routes",id:"configurer-les-routes",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"ajouter-le-namespace-pour-charger-automatiquement-les-controllers",children:"Ajouter le namespace pour charger automatiquement les controllers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="/routes/web.php"',children:"...\r\nreturn Application::configure(basePath: dirname(__DIR__))\r\n\r\n    /* -----------    ATTENTION : C'est l\xe0 qu'on ajoute le namespace pour les Controllers avec la syntaxe Controller@acion dans web.php    ----------- */\r\n    //highlight-start\r\n    ->withRouting(\r\n        commands: __DIR__ . '/../routes/console.php',\r\n        using: function(){\r\n            Route::middleware('web')\r\n                ->namespace('App\\Http\\Controllers')\r\n                ->group(base_path('routes/web.php'));\r\n        },\r\n    )\r\n    //highlight-end\r\n\r\n    // On peut aussi ajouter les alias des Middlewares\r\n    ->withMiddleware(function (Middleware $middleware) {\r\n\r\n        $middleware->alias([\r\n            // Perso pour savoir si on est sur le front\r\n            'is_front' => \\App\\Http\\Middleware\\IsFront::class\r\n        ]);\r\n\r\n    })\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="/routes/web.php"',children:"<?php\r\n//highlight-start\r\nnamespace App\\Http\\Controllers;\r\n//highlight-end\r\n\r\nuse Illuminate\\Support\\Facades\\Route;\r\n\r\n...\r\n\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.mdxAdmonitionTitle,{}),(0,s.jsxs)(n.p,{children:["Ajouter ",(0,s.jsx)(n.code,{children:"->namespace('App\\Http\\Controllers')"})," est n\xe9cessaire pour que syntaxe courte ",(0,s.jsx)(n.code,{children:"IndexController@home"})," des routes fonctionne."]})]}),"\n",(0,s.jsx)(n.h2,{id:"configurer-basecontroller-et-indexcontroller",children:"Configurer BaseController et IndexController"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="/app/Http/Controllers/BaseController.php"',children:"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Foundation\\Auth\\Access\\AuthorizesRequests;\r\nuse Illuminate\\Foundation\\Validation\\ValidatesRequests;\r\nuse Illuminate\\Routing\\Controller as LaravelController;\r\nuse Illuminate\\Support\\Facades\\View;\r\nuse JoliMardi\\Metas\\Services\\MetasService;\r\n\r\nclass BaseController extends LaravelController {\r\n    use AuthorizesRequests, ValidatesRequests;\r\n\r\n    public function __construct() {\r\n        // Chargement des variables globales utilisables dans toutes les vues, et overridables dans les controllers\r\n        View::share('title', MetasService::getTitle());\r\n        View::share('description', MetasService::getDescription());\r\n        View::share('og_image', '/img/example.jpg');\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Penser \xe0 cr\xe9er les vues correspondantes \xe0 chaque action, dans ",(0,s.jsx)(n.code,{children:"/resources/views/mapage.blade.php"})," par exemple, ou dans un sous-dossier avec la syntaxe ",(0,s.jsx)(n.code,{children:"return view('pages-editos.mapage')"})," pour la vue situ\xe9e dans ",(0,s.jsx)(n.code,{children:"/resources/views/pages-editos/mapage.blade.php"}),";"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="/app/Http/Controllers/IndexController.php"',children:"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Foundation\\Auth\\Access\\AuthorizesRequests;\r\nuse Illuminate\\Foundation\\Validation\\ValidatesRequests;\r\nuse Illuminate\\Http\\Request;\r\n//use App\\Models\\ContactMessage;\r\nuse JoliMardi\\Flash\\Flash;\r\n\r\nclass IndexController extends BaseController {\r\n    use AuthorizesRequests, ValidatesRequests;\r\n\r\n    public function home() {\r\n        //Flash::message('success', 'Une erreur s\\'est produite lors de l\\'envoi de votre message. Veuillez r\xe9essayer plus tard.');\r\n        return view('home');\r\n    }\r\n    \r\n    public function soins() {\r\n        return view('soins');\r\n    }\r\n\r\n    public function contact() {\r\n        return view('contact');\r\n    }\r\n\r\n    /* Pour plus tard \r\n    public function send(Request $request) {\r\n        // Validation\r\n        $request->validate([\r\n            'name' => 'required|min:3|max:255',\r\n            'email' => 'required|email',\r\n            'message' => 'required|min:5'\r\n        ]);\r\n\r\n        $params = [\r\n            'name' => $request->name,\r\n            'email' => $request->email,\r\n            'message' => $request->message\r\n        ];\r\n\r\n        $contactMessage = new ContactMessage;\r\n        $contactMessage->name = $request->name;\r\n        $contactMessage->email = $request->email;\r\n        $contactMessage->message = $request->message;\r\n\r\n        if ($contactMessage->save()) {\r\n            // Redirection avec flash message\r\n\r\n            $sendinBlueService = app(SendinBlueService::class);\r\n\r\n            if ($sendinBlueService->sendEmail($request->email, $request->name, $params, 3)) {\r\n                Flash::message('success', 'Merci pour votre message ! Nous vous r\xe9pondrons dans les plus brefs d\xe9lais.');\r\n                return back()->withInput();\r\n            } else {\r\n                return back()->withInput();\r\n            }\r\n        } else {\r\n            Flash::message('error', 'Une erreur s\\'est produite lors de l\\'envoi de votre message. Veuillez r\xe9essayer plus tard.');\r\n            return back()->withInput();\r\n        }\r\n    }\r\n    */\r\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Si erreur ",(0,s.jsx)(n.strong,{children:"Target class [IndexController] does not exist."}),", il faut ajouter ",(0,s.jsx)(n.code,{children:"->namespace..."})," dans RouteServiceProvider.php (voir au-dessus)"]})}),"\n",(0,s.jsx)(n.h2,{id:"configurer-les-routes",children:"Configurer les routes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="routes/web.php"',children:"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Support\\Facades\\Route;\r\n\r\n/* ----------    Index Controller   ---------------------- */\r\n\r\nRoute::get('/', 'IndexController@home')->name('home');\r\n\r\nRoute::get('/contact', 'IndexController@contact')->name('contact');\r\nRoute::post('/contact', 'IndexController@send')->name('contact.send'); // Mettre des points permet de filtrer des r\xe8gle splus tard sur admin.* par exemple\r\n\r\n// Exemple \xe9ditable\r\nRoute::get('mon-slug', 'MonController@mon_action')->name('mon_nom_de route'); // dans la vue : `href=\"{{ route('mon_nom_de_route')}}\"`\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"Exemple plus complet, \xe0 adapter selon le projet :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="routes/web.php"',children:"namespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Support\\Facades\\Route;\r\nuse App\\Http\\Controllers\\AdminController;\r\nuse Illuminate\\Support\\Facades\\Config;\r\n\r\n/* ----------    Index Controller   ---------------------- */\r\n\r\nRoute::name('home')->get('/', 'IndexController@home');\r\nRoute::name('contact')->get('contact', 'IndexController@contact');\r\nRoute::name('contact.send')->post('contact', 'IndexController@send');\r\n\r\nRoute::name('team')->get('team', 'IndexController@team');\r\nRoute::name('comment-ca-marche')->get('comment-ca-marche', 'IndexController@comment_ca_marche');\r\nRoute::name('mentions-legales')->get('mentions-legales', 'IndexController@mentions_legales');\r\n\r\n\r\n/* ----------    Artistes   ---------------------- */\r\n\r\nRoute::name('artists')->get('artistes', 'ArtistController@list');\r\nRoute::name('artists.view')->get('artistes/{slug}', 'ArtistController@view');\r\n\r\n// Exemple de param\xe8tre \"captur\xe9\" dans l'url\r\nRoute::name('artists.style')->get('artistes-{style}', 'ArtistController@style');\r\n\r\n\r\n\r\n/* ----------    Articles   ---------------------- */\r\n\r\n// Conseils\r\nRoute::name('posts')->get('conseils', 'PostController@list');\r\nRoute::name('posts.view')->get('conseils/{slug}', 'PostController@view');\r\n\r\n\r\n\r\n/* ----------    Admin   ---------------------- */\r\n\r\n$admin_prefix = Config::get('app.admin_slug', 'admin');\r\nRoute::middleware(['auth'])\r\n    ->prefix($admin_prefix)\r\n    ->controller(AdminController::class)\r\n    ->group(function () {\r\n        Route::get('/', 'dashboard')->name('admin.dashboard');\r\n        Route::post('/', 'dashboard')->name('admin.filterArtists');\r\n        Route::get('/logout', 'logout')->name('admin.logout');\r\n    });\r\nRoute::name('admin.login')->get($admin_prefix . '/login', 'AdminController@login');\r\nRoute::name('admin.check-login')->post($admin_prefix . '/check-login', 'AdminController@checkLogin');\r\n\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\xc9tape suivante :"})," ",(0,s.jsx)(n.a,{href:"./jquery-plugins",children:"6. jQuery & Plugins"})]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,r){r.d(n,{R:()=>a,x:()=>l});var t=r(6540);const s={},o=t.createContext(s);function a(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);